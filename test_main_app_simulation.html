<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main App Simulation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 8px 8px 8px 0;
        }
        .btn:hover {
            background: #0056b3;
        }
        .credit-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            margin: 5px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ Main App Simulation</h1>
        <p>Simulating the exact same conditions as the main app to test functionality.</p>
        
        <!-- Mock credit card -->
        <div class="credit-card">
            <h3>üí≥ Test Credit Card</h3>
            <p>Balance: $0.00 | Due Date: Not Set</p>
            
            <!-- Hidden file input for PDF upload -->
            <input type="file" id="statement-test-card-123" accept=".pdf,.csv,.ofx,.qfx" style="display: none;">
            
            <div style="margin-top: 10px;">
                <button class="btn" onclick="testQuickSetup()">‚ö° Quick Setup</button>
                <button class="btn" onclick="testPdfUpload()">üìÑ Upload Statement</button>
            </div>
            
            <div id="cardStatus"></div>
        </div>
        
        <div class="container">
            <h3>üîç Debug Information</h3>
            <button class="btn" onclick="showDebugInfo()">Show Debug Info</button>
            <div id="debugInfo"></div>
        </div>
    </div>

    <!-- Load scripts in the same order as main app -->
    <script src="js/utils.js"></script>
    <script src="js/state.js"></script>
    <script src="js/cards-convergent-v2-integration.js?v=1.0"></script>
    <script src="js/simple-cards-convergent.js"></script>
    <script src="js/statement-ingestion-wrapper.js"></script>
    <script src="js/ui.js?v=3.9"></script>

    <script>
        function testQuickSetup() {
            console.log('üß™ Testing quick setup...');
            const statusDiv = document.getElementById('cardStatus');
            statusDiv.innerHTML = '<div class="status info">üîÑ Testing quick setup...</div>';
            
            try {
                // Call the exact same function as the main app
                if (typeof window.quickSetupCC !== 'undefined') {
                    window.quickSetupCC('test-card-123');
                    statusDiv.innerHTML = '<div class="status success">‚úÖ Quick setup function called successfully!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå quickSetupCC function not found</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Quick setup failed: ${error.message}</div>`;
                console.error('Quick setup error:', error);
            }
        }
        
        function testPdfUpload() {
            console.log('üß™ Testing PDF upload...');
            const statusDiv = document.getElementById('cardStatus');
            statusDiv.innerHTML = '<div class="status info">üîÑ Testing PDF upload...</div>';
            
            try {
                // Call the exact same function as the main app
                if (typeof window.uploadStatement !== 'undefined') {
                    window.uploadStatement('test-card-123');
                    statusDiv.innerHTML = '<div class="status success">‚úÖ PDF upload function called successfully!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå uploadStatement function not found</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå PDF upload failed: ${error.message}</div>`;
                console.error('PDF upload error:', error);
            }
        }
        
        function showDebugInfo() {
            const debugDiv = document.getElementById('debugInfo');
            
            let html = '<div style="font-family: monospace; font-size: 12px; background: #f8f9fa; padding: 10px; border-radius: 4px;">';
            
            html += '<strong>Available Functions:</strong><br>';
            html += `window.CardsConvergentV2: ${typeof window.CardsConvergentV2}<br>`;
            html += `window.SimpleCardsConvergent: ${typeof window.SimpleCardsConvergent}<br>`;
            html += `window.StatementIngestionWrapper: ${typeof window.StatementIngestionWrapper}<br>`;
            html += `window.quickSetupCC: ${typeof window.quickSetupCC}<br>`;
            html += `window.uploadStatement: ${typeof window.uploadStatement}<br>`;
            html += `window.parseSummaryText: ${typeof window.parseSummaryText}<br>`;
            
            if (typeof window.CardsConvergentV2 !== 'undefined') {
                html += '<br><strong>Cards Convergent V2 Status:</strong><br>';
                try {
                    const status = window.CardsConvergentV2.getStatus();
                    html += `Version: ${status.version}<br>`;
                    html += `Enabled: ${status.enabled}<br>`;
                    html += `Features: ${status.features.length}<br>`;
                } catch (e) {
                    html += `Error getting status: ${e.message}<br>`;
                }
            }
            
            html += '</div>';
            
            debugDiv.innerHTML = html;
        }
        
        // Initialize
        window.addEventListener('load', function() {
            console.log('üöÄ Main app simulation loaded');
            showDebugInfo();
        });
    </script>
</body>
</html>
